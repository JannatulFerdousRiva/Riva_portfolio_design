<?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\AuthenticationController;
use App\Http\Controllers\Controller;

/*
|--------------------------------------------------------------------------
| Web Routes
|--------------------------------------------------------------------------
|
| Here is where you can register web routes for your application. These
| routes are loaded by the RouteServiceProvider and all of them will
| be assigned to the "web" middleware group. Make something great!
|
*/

//Authentication routes----------
Route::middleware(['guest'])->group(function () {
    // Login Routes
    Route::get('/login', function () {
        return view('auth.login');
    })->name('login');
    Route::post('/login', [AuthenticationController::class, 'login']);

    // Registration Routes
    Route::get('/registration', function () {
        return view('auth.registration');
    })->name('registration');
    Route::post('/registration', [AuthenticationController::class, 'registration']);
});

Route::post('/logout', [AuthenticationController::class, 'logout'])
    ->middleware('auth')
    ->name('logout');

// Admin routes with authentication
Route::prefix('admin')->group(function () {
    // Redirect /admin to dashboard, which will then redirect to login if not authenticated
    Route::redirect('/', '/admin/dashboard');

    // Protected admin routes
    Route::middleware(['auth', 'prevent-back-history'])->name('admin.')->group(function () {
Route::middleware(['auth', 'prevent-back-history'])->prefix('admin')->name('admin.')->group(function () {
    Route::get('/dashboard', [App\Http\Controllers\DashboardController::class, 'index'])->name('dashboard');
    
    // Projects routes
    Route::resource('projects', App\Http\Controllers\ProjectController::class)->names([
        'index' => 'projects.index',
        'create' => 'projects.create',
        'store' => 'projects.store',
        'edit' => 'projects.edit',
        'update' => 'projects.update',
        'destroy' => 'projects.destroy'
    ]);
    
    // Skills routes
    Route::resource('skills', App\Http\Controllers\SkillController::class)->names([
        'index' => 'skills.index',
        'create' => 'skills.create',
        'store' => 'skills.store',
        'edit' => 'skills.edit',
        'update' => 'skills.update',
        'destroy' => 'skills.destroy'
    ]);
    
    // Education routes
    Route::resource('education', App\Http\Controllers\EducationController::class)->names([
        'index' => 'education.index',
        'create' => 'education.create',
        'store' => 'education.store',
        'edit' => 'education.edit',
        'update' => 'education.update',
        'destroy' => 'education.destroy'
    ]);
    
    // Experience routes
    Route::resource('experience', App\Http\Controllers\ExperienceController::class)->names([
        'index' => 'experience.index',
        'create' => 'experience.create',
        'store' => 'experience.store',
        'edit' => 'experience.edit',
        'update' => 'experience.update',
        'destroy' => 'experience.destroy'
    ]);
    
    // Profile routes
    Route::get('/profile', [AuthenticationController::class, 'profile'])->name('profile');
    Route::post('/profile/update', [AuthenticationController::class, 'updateProfile'])->name('profile.update');
});

// Redirect root to login if not authenticated
Route::get('/', function () {
    return auth()->check() ? redirect('/admin/dashboard') : redirect('/login');
});


Route::get('/about', function () {
    return view('aboutme');
});

Route::get('/education', function () {
    return view('education');
});

Route::get('/skills', function () {
    return view('skill');
});

Route::get('/projects', function () {
    return view('project');
});

Route::get('/contact', function () {
    return view('contact');
});

});

